set background=dark
set autoindent
set ruler
set showcmd
set incsearch
set foldmethod=indent
set autowriteall
set autoread
set foldminlines=1
set backupdir=~/tmp
set shiftwidth=2
set tabstop=2
set expandtab
set textwidth=78 wrap

" begin freebsd needs
set backspace=indent,eol,start
syntax on
set hlsearch
" end freebsd needs


function! RHeader(char)
python << PYTHON
import vim
import re
c = vim.eval("a:char")
cb = vim.current.buffer
cw = vim.current.window
(row, col) = cw.cursor
width = int(vim.eval("&tw"))
matter = cb[row - 1].strip()
lead_in = re.sub("^(\S)", " \g<1>", c * 2)
cb[row - 1] = " " + lead_in + matter.rjust(width - 1 - len(lead_in))
rn = cb.range(row, row)
rn.append([ " " + (c * width) , "", "   " ])
cw.cursor = (row + 3, 2)
PYTHON
endfunction
nnoremap heading :silent! call RHeader("-")<CR>


runtime macros/justify.vim
nnoremap just :call Justify(&tw)<CR>

function! HaskellAlign()
ruby << RUBY
  l_bound = 32
  l_bound -= 5
  r_bound = 50 
  r_bound -= 2
  cb = VIM::Buffer.current
  cw = VIM::Window.current
  pat = / (<-|=|::) /
  ln = cb.line_number
  content = cb.line
  m = pat.match(content)
  if m
    front, back = m.pre_match.gsub(/[[:space:]]+$/, ''), m.post_match.strip
    too_long = (front.length > l_bound) or (back.length > r_bound)
    unless too_long or front.length.zero?
      formatted = front.ljust(l_bound) + m[0].rjust(4).ljust(5) + back
      cb[ln] = formatted
    end
  end
RUBY
endfunction
function! HaskellAlignAll()
  let a = line(".")
  let b = col(".")
  % call HaskellAlign()
  if cursor(a, b)
  endif
endfunction
nnoremap hal :call HaskellAlignAll() <CR>


filetype plugin indent on

autocmd FileType text setlocal textwidth=64 wrap
autocmd FileType mkd setlocal textwidth=78 wrap

" wikipedia is an annoying format
" i need to figure out some 1337 h4x for it
autocmd FileType wikipedia setlocal textwidth=78

if has("autocmd") && exists("+omnifunc")
	autocmd Filetype *
	\	if &omnifunc == "" |
	\		setlocal omnifunc=syntaxcomplete#Complete |
	\	endif
endif

au FileType c setlocal tabstop=8 shiftwidth=8 noexpandtab
au FileType python setlocal tabstop=4 shiftwidth=4 expandtab

augroup mkd
  autocmd BufRead *.mkd  set ai formatoptions=tcroqn2 comments=n:>
augroup END

" annoying initial highlights removed
nohlsearch

