#!/usr/bin/env bash
#
# My .bashrc is full of functions and macros -- the macros especially have
# taken me years to understand.
#

pskill()
{
        local pid

        pid=$(ps -ax | grep $1 | grep -v grep | awk '{ print $1 }')
        echo -n "killing $1 (process $pid)..."
        kill -9 $pid
}

load_file_if_exists()
{
  if [ -f "$1" ]
  then
    source "$1"
  fi
}

remove_if_exists()
{
  if [ -e "$1" ]
  then
    rm -rf "$1"
  fi
}

set_1_to_2_unless_4_fails_then_3()
{
  foo=`${4}`
  if [ $? -eq 0 ]
  then
    eval "export ${1}=${2}"
  else
    eval "export ${1}=${3}"
  fi
}

remove_if_exists  $HISTFILE

bc="bash_completion"
if [[ `uname` = 'FreeBSD' ]]
then
  bc="/usr/local/etc/${bc}"
  alias l='ls -G'
  alias ll='ls -GlA'
elif [[ `uname` = 'Linux' ]]
then
  bc="/etc/${bc}"
  alias l='ls --color'
  alias ll='ls -lA --color'
else
  bc="/etc/${bc}"
  alias l='ls'
  alias ll='ls -lA'
fi

load_file_if_exists $bc
[[ `pwd` -ef $HOME  ]] || load_file_if_exists ./.bashrc
load_file_if_exists /etc/profile


alias go='pushd'
alias b='popd'
alias h='history'
alias r='rm -r'
alias c='clear'
alias t='tail -n 50'
alias g='egrep --color'
alias x='exit'
alias ri='ri -f ansi'


umask 002
set -o vi


## begin prompt of power ##############################################
# I used to have the prompt set up as a bunch of functions; but that
# didn't work very well with sh. Now, I have mastered the various
# levels of evaluation and quoting of the shell and can confidently
# write hideous macros!

HIGH="\[\e[01;31m\]"
NORM="\[\e[00;0m\]"

d="pwd | awk '{ printf \"%-64s\", \$1 }'"
t="date +%R"
h="history 1 | xargs echo '' | awk '{ printf \"%3d\", \$1 + 1 }'"
c="[ $USER = root ] && echo '##' || echo ' #'"

prompt="${HIGH}\`${c}\` \`${d}\`  \`${t}\`  \`${h}\`\n  ${NORM}"

prepend=''
if [ "${TERM}" = "xterm" ]
then
  my_tty=`tty | awk -F/ '{ print $3 $4}'`
  xterm_title="\[\e]0;${my_tty} \u@\H\007\]"
  prepend="${xterm_title}"
fi

export  PROMPT_COMMAND="export PS1=\"${prepend}${prompt}\""

export  PS2='  '

## end prompt of power ################################################


set_1_to_2_unless_4_fails_then_3 "EDITOR" "vim" "vi" "which vim"

export  TEXEDIT="${EDITOR} +%d %s"
export  RUBYOPT="${RUBYOPT} -Ku"
export  BROWSER="firefox"
export  HISTIGNORE="&:h:exit"
export  PATH=$PATH:/sbin/:/usr/sbin/:$HOME/bin:./bin:.
export  TZ=/usr/share/zoneinfo/America/Los_Angeles
